<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1"><title>Ubuntu版Misskeyインストール方法詳説</title><!--*
*
* GitHub: https://github.com/joinmisskey
*
*--><link rel="canonical" href="https://join.misskey.page/ja/wiki/developers/installation/ubuntu"><link rel="alternate" hreflang="ja" href="https://join.misskey.page/ja/wiki/developers/installation/ubuntu"><link rel="alternate" hreflang="en" href="https://join.misskey.page/en/wiki/developers/installation/ubuntu"><link rel="alternate" hreflang="fr" href="https://join.misskey.page/fr/wiki/developers/installation/ubuntu"><link rel="alternate" hreflang="de" href="https://join.misskey.page/de/wiki/developers/installation/ubuntu"><meta name="author" content="Misskey"><meta name="generator" content="maqz"><meta name="robots" content="noindex,follow"><meta name="description" content="UbuntuをインストールしたサーバーでMisskeyを動作させる方法を詳細に解説。"><link rel="manifest" href="/manifest.json"><link rel="alternate" type="application/atom+xml" title="joinmisskey" href="https://join.misskey.page/feed.atom"><link rel="alternate" type="application/rss+xml" title="joinmisskey" href="https://join.misskey.page/feed.rss"><link rel="alternate" type="application/json" title="joinmisskey" href="https://join.misskey.page/feed.json"><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/mplus-c/mplus-c-light.latain.woff2" as="font" crossorigin><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/mplus-p/mplus-p-regular.latain.woff2" as="font" crossorigin><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/mplus-p/mplus-p-bold.latain.woff2" as="font" crossorigin><link rel="preload" href="/assets/styles/fonts.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/npm/yakuhanjp@3.3.0/dist/css/yakuhanjp.min.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/tamaina/The-Japanese-Web-Fonts@v7.2.0/dist/NasuM/NasuM.css" as="style"><link rel="preload" href="/assets/styles/fonts-ja.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.0/animate.min.css" as="style"><link rel="preload" href="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" as="script"><script id="page_variables">var pathname = "/";
var currentLocale = "ja";
var locales = ["ja","en","fr","de"];
var permalink = "/wiki/developers/installation/ubuntu";
var gaId = "UA-121612835-1";
var jm_pathToWorker = "https://join.misskey.page/service_worker.js"
</script><script src="/assets/scripts/sw.js" async></script><script src="/assets/scripts/bootstrap.js" async></script><script src="/assets/scripts/main.js" async></script><script src="https://www.googletagmanager.com/gtag/js?id=UA-121612835-1" async></script><link rel="stylesheet" href="/assets/styles/main.css"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: "ca-pub-1736621122676736",
  enable_page_level_ads: true,
  overlays: { bottom: true }
});
</script><link rel="icon" href="/favicon.ico" type="image/vnd.microsoft.icon"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2.svg?v=undefined" sizes="192x192"><link rel="icon" href="/files/images/imports/2020/03/icon-2.svg?v=undefined" sizes="192x192" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2-maskable.svg?v=undefined" sizes="192x192"><link rel="icon" href="/files/images/imports/2020/03/icon-2-maskable.svg?v=undefined" sizes="192x192" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2.svg?v=undefined" sizes="1200x1200"><link rel="icon" href="/files/images/imports/2020/03/icon-2.svg?v=undefined" sizes="1200x1200" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2-maskable.svg?v=undefined" sizes="1200x1200"><link rel="icon" href="/files/images/imports/2020/03/icon-2-maskable.svg?v=undefined" sizes="1200x1200" type="image/svg+xml"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2-maskable.360.png?v=undefined" sizes="360x360"><link rel="icon" href="/files/images/imports/2020/03/icon-2-maskable.360.png?v=undefined" sizes="360x360" type="image/png"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2-maskable.720.png?v=undefined" sizes="720x720"><link rel="icon" href="/files/images/imports/2020/03/icon-2-maskable.720.png?v=undefined" sizes="720x720" type="image/png"><link rel="apple-touch-icon" href="/files/images/imports/2020/03/icon-2-maskable.png?v=undefined" sizes="1200x1200"><link rel="icon" href="/files/images/imports/2020/03/icon-2-maskable.png?v=undefined" sizes="1200x1200" type="image/png"><meta name="theme-color" content="#86b300"><meta property="og:type" content="website"><meta property="og:title" content="Ubuntu版Misskeyインストール方法詳説"><meta property="og:description" content="UbuntuをインストールしたサーバーでMisskeyを動作させる方法を詳細に解説。"><meta property="og:image" content="https://join.misskey.page/files/images/imports/2019/10/thumb.png?v=undefined"><meta property="og:url" content="https://join.misskey.page/ja/wiki/developers/installation/ubuntu"><meta property="og:site_name" content="Misskeyをはじめよう"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://join.misskey.page/files/images/imports/2019/10/thumb.png?v=undefined"><meta name="twitter:title" content="Ubuntu版Misskeyインストール方法詳説"><meta name="twitter:description" content="UbuntuをインストールしたサーバーでMisskeyを動作させる方法を詳細に解説。"><meta name="twitter:site" content="misskey_io"></head><body><div id="nav"><nav class="navbar navbar-expand-md navbar-light flex-row p-0" id="mainnav"><button class="navbar-toggler" data-toggle="collapse" data-target="#navtoggle" aria-controls="navtoggle" aria-expanded="false" aria-label="Toggle navigation"><i class="fa fas bars" data-fa-prefix="fas" data-fa-icon-name="bars" data-fa-option="{}"></i></button><div class="collapse navbar-collapse" id="navtoggle"><ul class="navbar-nav mr-auto mt-lg-0 ml-3 ml-md-0"><li class="nav-item px-md-3"><a class="nav-link" href="/ja/"><i class="fa fas home" data-fa-prefix="fas" data-fa-icon-name="home" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;ホーム</span></a></li><li class="nav-item px-md-3"><a class="nav-link" href="/ja/wiki/instances/"><i class="fa fas server" data-fa-prefix="fas" data-fa-icon-name="server" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;インスタンス</span></a></li><li class="nav-item px-md-3"><a class="nav-link" href="/ja/blog/"><i class="fa fas broadcast-tower" data-fa-prefix="fas" data-fa-icon-name="broadcast-tower" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;ブログ</span></a></li><li class="nav-item px-md-3 active"><a class="nav-link" href="/ja/wiki/"><i class="fa fas book" data-fa-prefix="fas" data-fa-icon-name="book" data-fa-option="{'classes':['fa-fw']}"></i><span class="d-inline d-md-none d-lg-inline">&ensp;Wiki</span></a></li></ul><div class="input-group flex-nowrap" id="search"><input class="form-control" id="searchInput" type="search" placeholder="検索語句を入力" aria-label="検索"><div class="input-group-append flex-grow-0 flex-shrink-0"><button class="btn btn-primary" id="searchButton"><i class="fa fas search" data-fa-prefix="fas" data-fa-icon-name="search" data-fa-option="{'classes':['fa-fw']}"></i> 検索</button></div></div></div><div class="dropleft"><button class="btn btn-outline-primary dropdown-toggle" type="button" id="locale_dropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">A文</button><div class="dropdown-menu m-2" aria-labelledby="locale_dropdown"><button class="nihongo dropdown-item" data-lang="ja">日本語</button><button class="nihongo dropdown-item" data-lang="en">English</button><button class="nihongo dropdown-item" data-lang="fr">Français</button><button class="nihongo dropdown-item" data-lang="de">Deutsch</button></div></div></nav><nav class="bg-transparent" aria-label="breadcrumb" id="breadcrumb"><div class="container-fulid px-1 px-lg-5"><ol class="breadcrumb bg-transparent text-primary my-0 mx-md-5 mx-1 py-1 px-0" vocab="https://schema.org/" typeof="BreadcrumbList"><li class="breadcrumb-item" property="itemListElement" typeof="ListItem"><a class="text-primary" href="/ja/" property="item" typeof="WebPage"><i class="fa fas home" data-fa-prefix="fas" data-fa-icon-name="home" data-fa-option="{'classes':['fa-fw']}"></i><span class="sr-only" property="name">Misskeyをはじめよう</span></a><meta property="position" content="1"></li><li class="breadcrumb-item" property="itemListElement" typeof="ListItem"><a class="text-primary" href="/ja/wiki/" property="item" typeof="WebPage"><span property="name">Wiki</span></a><meta property="position" content="2"></li><li class="breadcrumb-item" property="itemListElement" typeof="ListItem"><a class="text-primary" href="/ja/wiki/developers/" property="item" typeof="WebPage"><span property="name">開発者・運営者向け情報</span></a><meta property="position" content="3"></li><li class="breadcrumb-item" property="itemListElement" typeof="ListItem"><a class="text-primary" href="/ja/wiki/developers/installation/" property="item" typeof="WebPage"><span property="name">Misskeyインストール方法詳説</span></a><meta property="position" content="4"></li><li class="breadcrumb-item active" property="itemListElement" typeof="ListItem"><a class="text-dark font-weight-bold trigger-gototop button-like-anchor" aria-current="page" href="https://join.misskey.page/ja/wiki/developers/installation/ubuntu" property="item" typeof="WebPage"><span property="name">Ubuntu版Misskeyインストール方法詳説</span></a><meta property="position" content="5"></li></ol></div></nav></div><div class="padding row" id="main"><div class="sade-outer d-none d-xl-block col-xl-3 order-1"><ins class="adsbygoogle p-0 sade d-none d-xl-block" style="display:block;" data-ad-client="ca-pub-1736621122676736" data-ad-slot="2773092095" data-ad-format="vertical" data-full-width-responsive="false"></ins></div><div class="p-0 col-12 px-xl-3 col-xl-9 order-0"><div class="container pt-5 pb-3 mb-2 bg-white main-shadow"><article class="bg-white" id="article_maincontent"><header class="w-100"><h1>Ubuntu版Misskeyインストール方法詳説</h1></header><div class="my-2 p-3 bg-light" id="article_sidenav"><details><summary class="font-weight-bold">目次</summary><ul class="list-unstyled ml-3 page-index m-0 p-0"><li><a href="#%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB">はじめに</a></li><li><a href="#%E7%92%B0%E5%A2%83%E3%81%A8%E6%9D%A1%E4%BB%B6">環境と条件</a></li><li><a href="#nano%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9">nanoの使い方</a></li><li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90">ユーザーの作成</a></li><li><a href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E8%A8%AD%E5%AE%9A">基本的なソフトウェアのインストールと設定</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#Node.js">Node.js</a></li><li><a href="#PostgreSQL">PostgreSQL</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">インストール</a></li><li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90">ユーザーとデータベースの作成</a></li></ul><li><a href="#Redis">Redis</a></li><li><a href="#nginx">nginx</a></li><li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96">その他</a></li></ul><li><a href="#%E8%BF%BD%E5%8A%A0%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%A8%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">追加の設定とインストール</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB">ファイヤーウォール</a></li><li><a href="#CloudFlare">CloudFlare</a></li><li><a href="#Certbot%20(Let's%20Encrypt)%20%E3%81%AE%E8%A8%AD%E5%AE%9A">Certbot (Let's Encrypt) の設定</a></li></ul><li><a href="#Misskey%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Misskeyのインストール</a></li><li><a href="#Misskey%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">Misskeyを設定する</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#default.yml">default.yml</a></li><li><a href="#nginx%E3%81%AE%E8%A8%AD%E5%AE%9A">nginxの設定</a></li></ul><li><a href="#Misskey%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89">Misskeyのビルド</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A7%E3%83%93%E3%83%AB%E3%83%89%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88">サーバーでビルドできない場合</a></li></ul><li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96">データベースの初期化</a></li><li><a href="#Misskey%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B">Misskeyを起動する</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88">アクセスできない場合</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#CloudFlare%E3%81%AEDNS%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">CloudFlareのDNSを確認する</a></li><li><a href="#%E3%83%AB%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">ルーターの設定を確認する</a></li></ul></ul><li><a href="#Misskey%E3%81%AE%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90">Misskeyのデーモンを作成</a></li><li><a href="#%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E4%BF%9D%E5%AD%98%E5%85%88%E3%81%AE%E8%A8%AD%E5%AE%9A%EF%BC%88%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%EF%BC%89">ドライブの保存先の設定（オプション）</a></li><ul class="list-unstyled ml-3 page-index"><li><a href="#%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">オブジェクトストレージを使用する</a></li><li><a href="#%E5%A4%96%E9%83%A8%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%81%AB%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AA%E3%83%83%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%92%E5%BC%B5%E3%82%8B">外部ストレージにシンボリックリンクを張る</a></li></ul><li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E7%A8%AE%E3%80%85%E3%81%AE%E8%A8%AD%E5%AE%9A">インスタンスの種々の設定</a></li></ul></details></div><section class="pt-2 pb-4"><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="%E3%81%AF%E3%81%98%E3%82%81%E3%81%AB" class="blogstyle">はじめに</h2><p>この記事では、<a href="https://github.com/syuilo/misskey/blob/master/docs/setup.ja.md" target="_blank" rel="noopener">リポジトリに同梱されている『Misskey構築の手引き』 (setup.md)<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を基に、サーバーへMisskeyをインストールし公開する方法の一挙手一投足を解説する。</p><p>Bashのコマンド入力、いくつかの設定ファイルの編集、そしてブラウザの操作だけで設定が完了するようにしている。インストールするソフトウェアについて簡単に説明しているが、気にする必要はない。</p><p>大まかな流れは上の<strong>目次</strong>をクリックし展開することで確認できる。</p><p>この記事では、具体性を重視し、特定の環境に特化した記述をしている。<br>OSの違い、Misskey本体や依存するソフトウェアのバージョンアップで変わってしまった部分等あるかもしれないが、ご容赦願いたい。</p><p>わからない単語については、<a href="https://wa3.i-3-i.info/" target="_blank" rel="noopener">『「分かりそう」で「分からない」でも「分かった」気になれるIT用語辞典』<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>で調べて分かった気になってほしい。</p><h2 id="%E7%92%B0%E5%A2%83%E3%81%A8%E6%9D%A1%E4%BB%B6" class="blogstyle">環境と条件</h2><ul><li>OSは<strong>Ubuntu 20.04.1 LTS</strong>を利用する。</li><li>ハードウェア要件としては、CPUは最近のものなら最小限で動く。アーキテクチャは<strong>amd64</strong>として解説を進める。<br>メモリは1GB程度あればよい。</li><li>独自のドメインを購入し、CloudFlareを使用する。<ul><li>ドメインは<a href="https://domains.google/intl/ja_jp/" target="_blank" rel="noopener">Google Domains<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>などで予め用意しておくこと。</li><li>ここではドメインを<code class="language-javascript">example<span class="token punctuation">.</span>tld</code>として解説を進めるので、自分が買ったドメインに適宜置き換えて読むこと。</li></ul></li><li>CloudFlareとサーバーとの通信にはHTTPSを使用し、証明書の生成にLet's Encryptを使用する。</li><li>nginxを使用する。</li><li>ElasticSearchは使用しない。</li><li>ほとんどのコマンドにroot権限が必要なため、<strong>root</strong>でコマンドを実行していく。<br>一般ユーザーでログインしている場合は<code class="language-javascript">sudo su <span class="token operator">-</span></code>を実行すればrootに切り替わる。</li></ul><h2 id="nano%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9" class="blogstyle">nanoの使い方</h2><p>今回はテキストエディターにnanoを使う。次のように起動する。</p><pre class="language-javascript"><code class="language-bash">nano <span class="token operator">/</span>path<span class="token operator">/</span>to<span class="token operator">/</span>file
</code></pre><p>一般的な矢印ボタンや<kbd>Home</kbd>/<kbd>End</kbd>などを利用してカーソルを移動できる。</p><p>終了は<kbd>Ctrl+X</kbd>で、変更を保存するか聞かれた場合<kbd>Y</kbd>(Yes)を入力し<kbd>Enter</kbd>すると保存できる。</p><p>下部にコマンド一覧が表示されるので、<code class="language-javascript"><span class="token operator">^</span></code>を<kbd>Ctrl</kbd>、<code class="language-javascript"><span class="token constant">M</span><span class="token operator">-</span></code>を<kbd>Alt</kbd>と読み替えて参考にしよう。</p><h2 id="%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">ユーザーの作成</h2><p>Misskeyはrootで実行しない方がよいため、専用のユーザーを作成する。</p><pre class="language-javascript"><code class="language-bash">adduser <span class="token operator">--</span>disabled<span class="token operator">-</span>password <span class="token operator">--</span>disabled<span class="token operator">-</span>login misskey
</code></pre><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E8%A8%AD%E5%AE%9A" class="blogstyle">基本的なソフトウェアのインストールと設定</h2><p>基本的なソフトウェアのインストールを行う。</p><h3 id="Node.js" class="blogstyle">Node.js</h3><p>Node.jsは、サーバーサイドJavaScript環境であり、Misskeyの基本的な実行環境である。</p><pre class="language-javascript"><code class="language-bash">apt install <span class="token operator">-</span>y curl
curl <span class="token operator">-</span>sL https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>deb<span class="token punctuation">.</span>nodesource<span class="token punctuation">.</span>com<span class="token operator">/</span>setup_current<span class="token punctuation">.</span>x <span class="token operator">|</span> sudo <span class="token operator">-</span><span class="token constant">E</span> bash <span class="token operator">-</span>
apt install <span class="token operator">-</span>y nodejs
</code></pre><p>Node.jsがインストールされたので、バージョンを確認する。</p><pre class="language-javascript"><code class="language-bash">node <span class="token operator">-</span>v
</code></pre><p><code class="language-javascript">v15<span class="token punctuation">.</span>x<span class="token punctuation">.</span>x</code>などと表示されればOK。<code class="language-javascript">v8<span class="token punctuation">.</span>x<span class="token punctuation">.</span>x</code>のように低いバージョンが表示された場合は、正しくインストールが行えていないため、サーバーを再起動してもう一度インストールし直すなどしてみよう。</p><h3 id="PostgreSQL" class="blogstyle">PostgreSQL</h3><p>PostgreSQLは、オブジェクト関係データベース管理システムであり、Misskeyが種々のデータを保存するために必要不可欠なソフトだ。</p><h4 id="%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" class="blogstyle">インストール</h4><p>シェルスクリプトを実行し、最新バージョンをインストールしよう。</p><pre class="language-javascript"><code class="language-bash">wget https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>salsa<span class="token punctuation">.</span>debian<span class="token punctuation">.</span>org<span class="token operator">/</span>postgresql<span class="token operator">/</span>postgresql<span class="token operator">-</span>common<span class="token operator">/</span>raw<span class="token operator">/</span>master<span class="token operator">/</span>pgdg<span class="token operator">/</span>apt<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span>org<span class="token punctuation">.</span>sh
sh apt<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span>org<span class="token punctuation">.</span>sh <span class="token operator">-</span>i <span class="token operator">-</span>v <span class="token number">13</span>
</code></pre><p>systemctlでデーモンの状態を確認。</p><pre class="language-javascript"><code class="language-bash">systemctl status postgresql
</code></pre><p>activeならOK。</p><h4 id="%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%81%A8%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E4%BD%9C%E6%88%90" class="blogstyle">ユーザーとデータベースの作成</h4><p>psqlを起動。</p><pre class="language-javascript"><code class="language-bash">sudo <span class="token operator">-</span>u postgres psql
</code></pre><p>postgresユーザーのパスワードを変更する。ここでは<code class="language-javascript">hoge</code>としているが、当然ながら自分で考えて設定すること。</p><pre class="language-javascript"><code class="language-sql">alter role postgres <span class="token keyword">with</span> password <span class="token string">'hoge'</span><span class="token punctuation">;</span>
</code></pre><p>データベースを作成。データベース名を<code class="language-javascript">mk1</code>としている。</p><pre class="language-javascript"><code class="language-sql">create database mk1<span class="token punctuation">;</span>
exit
</code></pre><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h3 id="Redis" class="blogstyle">Redis</h3><p>Redisは、NoSQLのインメモリデータベースソフトであり、データベースや連合との通信を管理するなどのために必要だ。</p><pre class="language-javascript"><code class="language-bash">add<span class="token operator">-</span>apt<span class="token operator">-</span>repository ppa<span class="token operator">:</span>chris<span class="token operator">-</span>lea<span class="token operator">/</span>redis<span class="token operator">-</span>server
apt update
apt install <span class="token operator">-</span>y redis<span class="token operator">-</span>server
systemctl start redis<span class="token operator">-</span>server
systemctl enable redis<span class="token operator">-</span>server
</code></pre><p>systemctlでデーモンの状態を確認。</p><pre class="language-javascript"><code class="language-bash">systemctl status redis<span class="token operator">-</span>server
</code></pre><p>activeならOK。</p><h3 id="nginx" class="blogstyle">nginx</h3><p>nginxは、主としてリバースプロキシに用いられるWebサーバーソフトである。Misskeyには必須ではないが、キャッシュ等をするとパフォーマンスが向上するためインストールしておく。</p><pre class="language-javascript"><code class="language-bash">apt install <span class="token operator">-</span>y curl gnupg2 ca<span class="token operator">-</span>certificates lsb<span class="token operator">-</span>release
echo <span class="token string">"deb http://nginx.org/packages/ubuntu `lsb_release -cs` nginx"</span> <span class="token operator">|</span> tee <span class="token operator">/</span>etc<span class="token operator">/</span>apt<span class="token operator">/</span>sources<span class="token punctuation">.</span>list<span class="token punctuation">.</span>d<span class="token operator">/</span>nginx<span class="token punctuation">.</span>list
curl <span class="token operator">-</span>fsSL https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>nginx<span class="token punctuation">.</span>org<span class="token operator">/</span>keys<span class="token operator">/</span>nginx_signing<span class="token punctuation">.</span>key <span class="token operator">|</span> apt<span class="token operator">-</span>key add <span class="token operator">-</span>
apt update
apt install <span class="token operator">-</span>y nginx
</code></pre><p>systemctlでデーモンの状態を確認。</p><pre class="language-javascript"><code class="language-bash">systemctl status nginx
</code></pre><p>activeならOK。そうでなければ、次のコマンドを実行。</p><pre class="language-javascript"><code class="language-bash">systemctl start nginx
systemctl enable nginx
</code></pre><p><a href="http://localhost" target="_blank" rel="noopener">http://localhost</a> にアクセスし、**Welcome to nginx!**と表示されればOK。</p><pre class="language-javascript"><code class="language-bash">curl http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost
</code></pre><p><small><a href="https://nginx.org/en/linux_packages.html#Ubuntu" target="_blank" rel="noopener">https://nginx.org/en/linux_packages.html#Ubuntu</a></small></p><h3 id="%E3%81%9D%E3%81%AE%E4%BB%96" class="blogstyle">その他</h3><p>Git（バージョン管理ソフト）およびbuild-essential（Misskeyのビルド時に必要）をインストールする。</p><pre class="language-javascript"><code class="language-bash">apt update
apt install <span class="token operator">-</span>y git build<span class="token operator">-</span>essential
</code></pre><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="%E8%BF%BD%E5%8A%A0%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%A8%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" class="blogstyle">追加の設定とインストール</h2><p>サーバーをインターネットに公開する準備をする。</p><h3 id="%E3%83%95%E3%82%A1%E3%82%A4%E3%83%A4%E3%83%BC%E3%82%A6%E3%82%A9%E3%83%BC%E3%83%AB" class="blogstyle">ファイヤーウォール</h3><p>今回は、ファイヤーウォールとしてufwを使用する。</p><p>次では、接続許可をホワイトリスト形式とし、22番SSHポートを接続回数制限を設けながら開放、80番HTTPポート及び443番HTTPSポートを開放とした。</p><pre class="language-javascript"><code class="language-bash">ufw enable
ufw <span class="token keyword">default</span> deny
ufw limit <span class="token number">22</span>
ufw allow <span class="token number">80</span>
ufw allow <span class="token number">443</span>
</code></pre><p>ufwのステータスを確認しておく。</p><pre class="language-javascript"><code class="language-bash">ufw status
</code></pre><h3 id="CloudFlare" class="blogstyle">CloudFlare</h3><p>CloudFlareは、自分のドメインに対してDNSサーバー・リバースプロキシ・CDNをいっぺんに提供してくれるたいへん便利なサービスである。<br>CloudFlareを経由せずにサーバーを公開することも可能だが、たいへん便利なので導入することをお勧めする。</p><p><a href="https://dash.cloudflare.com/sign-up" target="_blank" rel="noopener">CloudFlareにサインアップ<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>し、購入したドメインを案内に従って登録する。<br>DNSの登録画面でサーバーのIPアドレスを入力しておくとよい。<br>ドメインを購入した所によっては適用に3日程度かかる場合がある。</p><h3 id="Certbot%20(Let's%20Encrypt)%20%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">Certbot (Let's Encrypt) の設定</h3><p>HTTPS･WSS通信に使用する証明書をCloudFlareを使う方式でLet's Encryptから取得する。</p><p>certbotとCloudFlareプラグインをインストール</p><pre class="language-javascript"><code class="language-bash">apt install <span class="token operator">-</span>y certbot python3<span class="token operator">-</span>certbot<span class="token operator">-</span>dns<span class="token operator">-</span>cloudflare
</code></pre><p>CloudFlareの情報を記載した設定ファイル<code class="language-javascript"><span class="token operator">/</span>etc<span class="token operator">/</span>cloudflare<span class="token operator">/</span>cloudflare<span class="token punctuation">.</span>ini</code>を作成する。</p><pre class="language-javascript"><code class="language-bash">mkdir <span class="token operator">/</span>etc<span class="token operator">/</span>cloudflare
nano <span class="token operator">/</span>etc<span class="token operator">/</span>cloudflare<span class="token operator">/</span>cloudflare<span class="token punctuation">.</span>ini
</code></pre><p><code class="language-javascript">dns_cloudflare_email</code>（下の例では<code class="language-javascript">bar@fuga<span class="token punctuation">.</span>foo</code>）にはCloudFlareで登録しているメールアドレスを設定する。</p><p><code class="language-javascript">dns_cloudflare_api_key</code>（下の例の<code class="language-javascript">xxx<span class="token operator">...</span></code>）は、次の手順で取得できる。</p><ol><li>ブラウザでCloudFlareにログイン</li><li>右上をクリック</li><li>My Profileを選択</li><li>API Tokensを選択</li><li>Global API KeyのViewを選択</li><li>パスワードを入力しreCAPTCHAを解除、Viewを選択</li></ol><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><pre class="language-javascript"><code class="language-ini">dns_cloudflare_email <span class="token operator">=</span> bar@fuga<span class="token punctuation">.</span>foo
dns_cloudflare_api_key <span class="token operator">=</span> xxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre><p>これを保存し、パーミッションを<code class="language-javascript"><span class="token number">600</span></code>に設定。</p><pre class="language-javascript"><code class="language-bash">chmod <span class="token number">600</span> <span class="token operator">/</span>etc<span class="token operator">/</span>cloudflare<span class="token operator">/</span>cloudflare<span class="token punctuation">.</span>ini
</code></pre><p>準備ができたのでコマンドを実行する。<strong>途中の2箇所の<code class="language-javascript">example<span class="token punctuation">.</span>tld</code>は自分のものに置き換えること</strong>。</p><pre class="language-javascript"><code class="language-bash">certbot certonly <span class="token operator">--</span>dns<span class="token operator">-</span>cloudflare <span class="token operator">--</span>dns<span class="token operator">-</span>cloudflare<span class="token operator">-</span>credentials <span class="token operator">/</span>etc<span class="token operator">/</span>cloudflare<span class="token operator">/</span>cloudflare<span class="token punctuation">.</span>ini <span class="token operator">--</span>dns<span class="token operator">-</span>cloudflare<span class="token operator">-</span>propagation<span class="token operator">-</span>seconds <span class="token number">60</span> <span class="token operator">--</span>server https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>acme<span class="token operator">-</span>v02<span class="token punctuation">.</span>api<span class="token punctuation">.</span>letsencrypt<span class="token punctuation">.</span>org<span class="token operator">/</span>directory <span class="token operator">-</span>d example<span class="token punctuation">.</span>tld <span class="token operator">-</span>d <span class="token operator">*</span><span class="token punctuation">.</span>example<span class="token punctuation">.</span>tld <span class="token operator">--</span>dns<span class="token operator">-</span>cloudflare <span class="token operator">--</span>dns<span class="token operator">-</span>cloudflare<span class="token operator">-</span>credentials <span class="token operator">/</span>etc<span class="token operator">/</span>cloudflare<span class="token operator">/</span>cloudflare<span class="token punctuation">.</span>ini <span class="token operator">--</span>dns<span class="token operator">-</span>cloudflare<span class="token operator">-</span>propagation<span class="token operator">-</span>seconds <span class="token number">50</span>
</code></pre><p>**Congratulations!**と表示されたらOK。生成された<code class="language-javascript"><span class="token punctuation">.</span>pem</code>ファイルのパスは今後使うので記録しておくこと。</p><p>cronの設定はインストールと同時に行われているため不要。</p><p><small><a href="https://qiita.com/ooxif/items/99ad3c93d4d6862d45f0" target="_blank" rel="noopener">https://qiita.com/ooxif/items/99ad3c93d4d6862d45f0</a></small></p><h2 id="Misskey%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" class="blogstyle">Misskeyのインストール</h2><p>これで前準備はあらかた終わったので、Misskeyを準備していく。</p><p><a href="https://github.com/syuilo/misskey/blob/master/docs/setup.ja.md#3-misskey%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB" target="_blank" rel="noopener">setup.mdの3.<i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を順に実行する。なお、一部アレンジを加えている。</p><p><code class="language-javascript">misskey</code>ユーザーに変更。</p><pre class="language-javascript"><code class="language-bash">su <span class="token operator">-</span> misskey
</code></pre><p>Gitでファイル類を展開。</p><pre class="language-javascript"><code class="language-bash">git clone <span class="token operator">-</span>b master git<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>syuilo<span class="token operator">/</span>misskey<span class="token punctuation">.</span>git
cd misskey
git checkout master
</code></pre><p>必要なnpmパッケージをインストール。</p><pre class="language-javascript"><code class="language-bash">npx yarn install
</code></pre><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="Misskey%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B" class="blogstyle">Misskeyを設定する</h2><h3 id="default.yml" class="blogstyle">default.yml</h3><p>設定ファイル<code class="language-javascript"><span class="token punctuation">.</span>config<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>yml</code>を作成。</p><pre class="language-javascript"><code class="language-bash">nano <span class="token punctuation">.</span>config<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>yml
</code></pre><p>次の内容を貼り付け、適宜置き換える。設定値の変更が必要な箇所は<code class="language-javascript">●</code>で、これまでの流れの中で設定した値を用いる箇所は<code class="language-javascript">〇</code>で示した。<br>この設定ファイルはYAML形式で書かれており、行頭のスペースの数などを間違えるとMisskeyが動かないので、特に注意すること。</p><p>設定できる値と記述方法は<a href="https://github.com/syuilo/misskey/blob/develop/.config/example.yml" target="_blank" rel="noopener"><code class="language-javascript"><span class="token punctuation">.</span>config<span class="token operator">/</span>example<span class="token punctuation">.</span>yml</code><i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>に書かれている。</p><pre class="language-javascript"><code class="language-yaml"># ● Misskeyを公開する<span class="token constant">URL</span>
url<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">example.tld</span><span class="token regex-delimiter">/</span></span>

# 　 ポートを<span class="token number">3000</span>とする。
port<span class="token operator">:</span> <span class="token number">3000</span>

# ● PostgreSQLの設定。
db<span class="token operator">:</span>
  host<span class="token operator">:</span> localhost
  port<span class="token operator">:</span> <span class="token number">5432</span>
  db  <span class="token operator">:</span> mk1      # 〇 PostgreSQLのデータベース名
  user<span class="token operator">:</span> postgres # 〇 PostgreSQLのユーザー名
  pass<span class="token operator">:</span> hoge     # ● PostgreSQLのパスワード

# 　 Redisの設定。
redis<span class="token operator">:</span>
  host<span class="token operator">:</span> localhost
  port<span class="token operator">:</span> <span class="token number">6379</span>

# 　 <span class="token constant">ID</span>タイプの設定。
id<span class="token operator">:</span> <span class="token string">'aid'</span>
</code></pre><p>指定できたら保存する。</p><h3 id="nginx%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">nginxの設定</h3><p>nginxの設定を行う。</p><p>ルート権限で行う。</p><pre class="language-javascript"><code class="language-bash">exit
</code></pre><p>Misskey付属の設定ファイル<a href="https://github.com/syuilo/misskey/blob/master/docs/examples/misskey.nginx" target="_blank" rel="noopener"><code class="language-javascript">docs<span class="token operator">/</span>examples<span class="token operator">/</span>misskey<span class="token punctuation">.</span>nginx</code><i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>を<code class="language-javascript"><span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>sites<span class="token operator">-</span>available<span class="token operator">/</span>misskey<span class="token punctuation">.</span>conf</code>として保存し、nanoで開く。</p><pre class="language-javascript"><code class="language-bash">cp <span class="token operator">/</span>home<span class="token operator">/</span>misskey<span class="token operator">/</span>misskey<span class="token operator">/</span>docs<span class="token operator">/</span>examples<span class="token operator">/</span>misskey<span class="token punctuation">.</span>nginx <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>misskey<span class="token punctuation">.</span>conf
nano <span class="token operator">/</span>etc<span class="token operator">/</span>nginx<span class="token operator">/</span>conf<span class="token punctuation">.</span>d<span class="token operator">/</span>misskey<span class="token punctuation">.</span>conf
</code></pre><p>次の部分を自分のものに書き換える。</p><ul><li>18行目と30行目のドメイン名</li><li>34-35行目の証明書へのパスをCertbotで取得したものに</li></ul><p>変更を保存する。</p><p>設定ファイルがきちんと機能するか確認。</p><pre class="language-javascript"><code class="language-bash">nginx <span class="token operator">-</span>t
</code></pre><p>OKならば、nginxデーモンを再起動。</p><pre class="language-javascript"><code class="language-bash">systemctl restart nginx
</code></pre><p>ステータスを確認。</p><pre class="language-javascript"><code class="language-bash">systemctl status nginx
</code></pre><p>activeであればOK。</p><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="Misskey%E3%81%AE%E3%83%93%E3%83%AB%E3%83%89" class="blogstyle">Misskeyのビルド</h2><p>misskeyユーザーにログインし直す。</p><pre class="language-javascript"><code class="language-bash">su <span class="token operator">-</span> misskey
</code></pre><p>ビルドをする。yes we can...</p><pre class="language-javascript"><code class="language-bash">cd misskey
<span class="token constant">NODE_ENV</span><span class="token operator">=</span>production npm run build
</code></pre><h3 id="%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A7%E3%83%93%E3%83%AB%E3%83%89%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88" class="blogstyle">サーバーでビルドできない場合</h3><p>サーバーのマシンスペックが低すぎてビルドが不可能な場合、ローカル環境（Windows、Macでもよい）でビルドしSFTPやSCPで転送することでも対応できる。<br>ビルドにはメモリが2GB程度必要と言われている。</p><ol><li>サーバーと同じバージョンのNode.jsをインストール</li></ol><ul><li>Windowsではnが利用できないので注意。</li></ul><ol start="2"><li>Git clone、もしくはGitHubからMisskeyのソースをダウンロードする</li><li>サーバーと同様の<code class="language-javascript"><span class="token punctuation">.</span>config<span class="token operator">/</span><span class="token keyword">default</span><span class="token punctuation">.</span>yml</code>を作成</li><li><code class="language-javascript">npx yarn install</code></li><li><code class="language-javascript"><span class="token constant">NODE_ENV</span><span class="token operator">=</span>production npx yarn build</code></li></ol><ul><li>PowerShellでは変数指定がこの方法でできないので、以下のようにする:<br><code class="language-javascript">$env<span class="token operator">:</span><span class="token constant">NODE_ENV</span><span class="token operator">=</span><span class="token string">"production"</span></code><br><code class="language-javascript">npm run build</code></li></ul><ol start="6"><li>生成されたbuiltフォルダーをサーバーにコピー</li></ol><h2 id="%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E5%88%9D%E6%9C%9F%E5%8C%96" class="blogstyle">データベースの初期化</h2><pre class="language-javascript"><code class="language-bash">npm run init
</code></pre><h2 id="Misskey%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%99%E3%82%8B" class="blogstyle">Misskeyを起動する</h2><pre class="language-javascript"><code class="language-bash"><span class="token constant">NODE_ENV</span><span class="token operator">=</span>production npx yarn start
</code></pre><p><strong>Now listening on port 3000 on <a href="http://example.tld" target="_blank" rel="noopener">http://example.tld</a></strong> と表示されたら、設定したURLにアクセスする。</p><p>Misskeyのウェルカムページが表示されるはずだ。</p><p>アカウントの作成、ノートの作成やファイルのアップロードといった一通りの操作が正しく行えるか確認しよう。</p><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h3 id="%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88" class="blogstyle">アクセスできない場合</h3><h4 id="CloudFlare%E3%81%AEDNS%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B" class="blogstyle">CloudFlareのDNSを確認する</h4><p>CloudFlareのDNS設定が正しいIPアドレスになっているかもう一度確認しよう。</p><h4 id="%E3%83%AB%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B" class="blogstyle">ルーターの設定を確認する</h4><p>自宅サーバーの場合、ルーターがサーバーと外部との80ポート・443ポートの通信を許可する設定になっているかどうか確認しよう。</p><h2 id="Misskey%E3%81%AE%E3%83%87%E3%83%BC%E3%83%A2%E3%83%B3%E3%82%92%E4%BD%9C%E6%88%90" class="blogstyle">Misskeyのデーモンを作成</h2><p>いったん<kbd>Ctrl+C</kbd>でプロセスをキルし、Misskeyをデーモンで起動する設定をしよう。</p><p>ルート権限で行う。</p><pre class="language-javascript"><code class="language-bash">exit
</code></pre><p><code class="language-javascript"><span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>misskey<span class="token punctuation">.</span>service</code>を作成する。</p><pre class="language-javascript"><code class="language-bash">nano <span class="token operator">/</span>etc<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>misskey<span class="token punctuation">.</span>service
</code></pre><p>次の内容を貼り付け、保存する。</p><pre class="language-javascript"><code class="language-ini"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
Description<span class="token operator">=</span>Misskey daemon

<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
Type<span class="token operator">=</span>simple
User<span class="token operator">=</span>misskey
ExecStart<span class="token operator">=</span><span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>bin<span class="token operator">/</span>npm start
WorkingDirectory<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>misskey<span class="token operator">/</span>misskey
Environment<span class="token operator">=</span><span class="token string">"NODE_ENV=production"</span>
TimeoutSec<span class="token operator">=</span><span class="token number">60</span>
StandardOutput<span class="token operator">=</span>syslog
StandardError<span class="token operator">=</span>syslog
SyslogIdentifier<span class="token operator">=</span>misskey
Restart<span class="token operator">=</span>always

<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
WantedBy<span class="token operator">=</span>multi<span class="token operator">-</span>user<span class="token punctuation">.</span>target
</code></pre><p>systemdを設定し、misskeyデーモンを開始。</p><pre class="language-javascript"><code class="language-bash">systemctl daemon<span class="token operator">-</span>reload
systemctl enable misskey
systemctl start misskey
</code></pre><p>systemctlでデーモンの状態を確認。起動に少し時間がかかるため、15秒程度待ってからのほうが良い。</p><pre class="language-javascript"><code class="language-bash">systemctl status misskey
</code></pre><p>activeならOK。</p><p><strong>これでMisskeyのインストールはほぼ完了だ。</strong></p><ins class="adsbygoogle my-5" style="display:block; text-align:left;" data-ad-layout="in-article" data-ad-format="fluid" data-ad-client="ca-pub-1736621122676736" data-ad-slot="9247410221"></ins><h2 id="%E3%83%89%E3%83%A9%E3%82%A4%E3%83%96%E3%81%AE%E4%BF%9D%E5%AD%98%E5%85%88%E3%81%AE%E8%A8%AD%E5%AE%9A%EF%BC%88%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%EF%BC%89" class="blogstyle">ドライブの保存先の設定（オプション）</h2><p>初期設定では、ドライブのファイルはワーキングディレクトリの<code class="language-javascript">files</code>ディレクトリ（つまり<code class="language-javascript"><span class="token operator">/</span>home<span class="token operator">/</span>misskey<span class="token operator">/</span>misskey<span class="token operator">/</span>files</code>）に直接保存される。<br>サーバーのストレージが限られている場合、他の場所に保存する必要がある。</p><h3 id="%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B" class="blogstyle">オブジェクトストレージを使用する</h3><p>VPSはディスク容量が制限されており単価が高いため、オブジェクトストレージの利用は必須に近い。</p><p><code class="language-javascript">インスタンス</code> &gt; <code class="language-javascript">設定</code> &gt; <code class="language-javascript">オブジェクトストレージ</code>でオブジェクトストレージを設定できる。</p><p>公式インスタンスの<a href="../culture/instances/misskey.io">misskey.io</a>では、オブジェクトストレージにDigitalOcean Spacesを利用している。<br><a href="https://m.do.co/c/bb9c27bc1a07" target="_blank" rel="noopener">こちらのリンク <small>https://m.do.co/c/bb9c27bc1a07</small><i class="fa fas external-link-alt" data-fa-prefix="fas" data-fa-icon-name="external-link-alt" data-fa-option="{'classes':['fa-fw', 'fa-sm']}"></i></a>からDigitalOceanに登録すると、**$50分のクレジットがもらえる**のでぜひ登録してみてほしい。<br>クレジットカードを持っていない方も、PayPalアカウントで登録できる。</p><h3 id="%E5%A4%96%E9%83%A8%E3%82%B9%E3%83%88%E3%83%AC%E3%83%BC%E3%82%B8%E3%81%AB%E3%82%B7%E3%83%B3%E3%83%9C%E3%83%AA%E3%83%83%E3%82%AF%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%92%E5%BC%B5%E3%82%8B" class="blogstyle">外部ストレージにシンボリックリンクを張る</h3><p>自宅サーバーなどでオブジェクトストレージを契約するほどではないものの、ストレージの容量が足りない等の理由で保存先を変更したい場合がある。<br>このような場合、<code class="language-javascript">files</code>ディレクトリとしてシンボリックリンクを作ることで外部ストレージ等にファイルを保存できる。</p><h2 id="%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AE%E7%A8%AE%E3%80%85%E3%81%AE%E8%A8%AD%E5%AE%9A" class="blogstyle">インスタンスの種々の設定</h2><p>その他様々なインスタンスの設定があるが、インスタンス設定（<code class="language-javascript"><span class="token operator">/</span>instance<span class="token operator">/</span>settings</code>）にて設定できる内容とその方法を確認できる。</p><p>また、このサイトにもいくつかの記事があるので参考にしてほしい。<br><a href="../#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E5%80%8B%E5%88%A5%E8%A8%98%E4%BA%8B">→ <strong>開発者・運営者向け情報#その他の個別記事</strong></a></p></section><footer class="w-100"><div class="d-flex flex-wrap my-2 bg-light"><a class="p-3 flex-fill" href="/ja/wiki/developers/email" id="next"><div class="container">次: メールサーバーを設定する</div></a></div></footer></article><div class="small text-right mt-3"><a href="https://github.com/joinmisskey/joinmisskey.github.io/edit/pages/ja/wiki/developers/installation/ubuntu.md" target="_blank" rel="noopener"><i class="fa fas pencil-alt" data-fa-prefix="fas" data-fa-icon-name="pencil-alt" data-fa-option="{'classes':['fa-fw']}"></i>このページを編集</a></div></div></div><div class="py-3 col-12 px-0 w-100 order-2 text-center"><ins class="adsbygoogle container p-0" style="display:block;" data-ad-client="ca-pub-1736621122676736" data-ad-slot="4446014841" data-ad-format="auto" data-full-width-responsive="false"></ins></div></div><div class="bg-white mt-2" id="footer"><div class="py-3" id="footer_wrap"><div class="container"><div class="d-flex justify-content-between flex-wrap small"><div>© 2018-2021 Misskey</div><!--.
.
.
--><div class="text-muted" id="updateTime">2021年3月24日 12:02 JST 更新</div><!--.
.
.
--><div><a href="https://github.com/syuilo/misskey" target="_blank" rel="noopener"><i class="fa fab github" data-fa-prefix="fab" data-fa-icon-name="github" data-fa-option="{'classes':['fa-fw']}"></i><span class="sr-only">GitHub</span>Misskey</a> <a href="https://github.com/joinmisskey/joinmisskey.github.io" target="_blank" rel="noopener"><i class="fa fab github" data-fa-prefix="fab" data-fa-icon-name="github" data-fa-option="{'classes':['fa-fw']}"></i><span class="sr-only">GitHub</span>joinmisskey</a> <a href="https://misskey.io/@joinmisskey" target="_blank" rel="noopener"><svg aria-hidden="true" focusable="false" role="img" class="svg-inline--fa fa-w-16 fa-fw" version="1.1" viewBox="0 0 225.24 256.53" xmlns="http://www.w3.org/2000/svg"><path d="m112.63 0c-4.0923 0-7.873 2.183-9.9199 5.7266-5.7762 10.005-12.904 22.35-18.006 31.187-4.1125 7.1231-4.1125 15.896 0 23.02 5.0963 8.8286 12.217 21.157 17.99 31.158 2.0498 3.5493 5.836 5.7363 9.9355 5.7363s7.8877-2.187 9.9375-5.7363c5.7734-10.001 12.891-22.328 17.988-31.158 4.1125-7.1216 4.1125-15.896 0-23.02-5.1021-8.8372-12.228-21.182-18.006-31.187-2.0454-3.5435-5.8276-5.7266-9.9199-5.7266zm0 8.6426c1.0054 0 1.9328 0.53621 2.4356 1.4062l18.006 31.186c2.5683 4.4481 2.5683 9.9288 0 14.377-5.0978 8.83-12.215 21.157-17.99 31.158-0.5056 0.8758-1.44 1.416-2.4512 1.416s-1.9456-0.54022-2.4512-1.416c-5.7734-10.001-12.891-22.328-17.988-31.156-2.5683-4.4496-2.5683-9.9308 0-14.379 5.1021-8.8372 12.228-21.18 18.004-31.186 0.50272-0.87004 1.4315-1.4062 2.4355-1.4062zm101.13 49.76c-11.553 3.46e-4 -25.805 0.001897-36.01 0.001953-8.225-2e-6 -15.823 4.3867-19.936 11.51-5.0976 8.8278-12.216 21.156-17.99 31.156-2.0489 3.5498-2.0498 7.9243 0 11.475 2.0498 3.5503 5.8388 5.7378 9.9375 5.7383 11.548-6.8e-4 25.783-0.00176 35.979-0.00195 8.2238 7.2e-4 15.823-4.3867 19.936-11.51 5.1022-8.8371 12.23-21.179 18.006-31.186 2.0461-3.5432 2.0462-7.911 0-11.455-2.0462-3.5441-5.8296-5.7276-9.9219-5.7285zm-202.27 0.02539c-4.0915-3.53e-4 -7.8738 2.1844-9.9199 5.7285-2.0462 3.5441-2.0453 7.9107 0 11.455 5.7768 10.005 12.904 22.348 18.006 31.186 4.1125 7.123 11.712 11.51 19.938 11.51 10.194 7.3e-4 24.429-6.7e-4 35.977 0 4.0987-5e-4 7.8877-2.186 9.9375-5.7363 2.0498-3.5503 2.0489-7.9248 0-11.475-5.7745-10-12.892-22.328-17.99-31.158-4.1112-7.1223-11.711-11.51-19.936-11.51-10.204-5.7e-5 -24.458-9.03e-4 -36.012 0zm27.98 79.814c-8.225-1e-5 -15.825 4.3887-19.938 11.512-5.0976 8.8278-12.214 21.156-17.988 31.156-2.0489 3.5498-2.0498 7.9224 0 11.473 2.0498 3.5503 5.8388 5.7378 9.9375 5.7383 11.548-6.8e-4 25.783 1.9e-4 35.979 0 8.2238 7.2e-4 15.823-4.3867 19.936-11.51 5.1022-8.8371 12.228-21.181 18.004-31.188 2.0461-3.5432 2.0462-7.911 0-11.455-2.0462-3.5441-5.8277-5.7257-9.9199-5.7266-11.553 3.4e-4 -25.805-6e-5 -36.01 0zm110.3 0.02343c-4.0915-3.4e-4 -7.8738 2.1844-9.9199 5.7285s-2.0473 7.9107-0.00196 11.455c5.7768 10.005 12.904 22.348 18.006 31.186 4.1125 7.1231 11.712 11.51 19.938 11.51 10.194 7.3e-4 24.429-6.7e-4 35.977 0 4.0986-5e-4 7.8877-2.186 9.9375-5.7363 2.0498-3.5503 2.0489-7.9248 0-11.475-5.7745-10-12.892-22.328-17.99-31.158-4.1112-7.1223-11.711-11.51-19.936-11.51-10.204-5e-5 -24.456-8.9e-4 -36.01 0zm-110.3 8.6192c10.204-6e-5 24.457 3.4e-4 36.01 0 1.0048 3.5e-4 1.9335 0.53676 2.4355 1.4062 0.50272 0.87074 0.50211 1.9421 0 2.8125l-18.004 31.186c-2.568 4.4483-7.3148 7.1896-12.451 7.1895-10.196 2e-4 -24.43-0.00139-35.979-0.00196-1.0113 4e-5 -1.9475-0.53833-2.4531-1.4141-0.5056-0.87572-0.50566-1.9563 0-2.832 5.7745-10 12.891-22.327 17.988-31.156 2.5693-4.449 7.3168-7.1896 12.453-7.1894zm110.3 0.02343h36.01c5.1364-1.8e-4 9.8832 2.7412 12.451 7.1895 5.0981 8.8298 12.216 21.157 17.99 31.158 0.50566 0.87576 0.5056 1.9544 0 2.8301-0.5056 0.87573-1.4419 1.416-2.4531 1.416-11.548-6.7e-4 -25.782-5.2e-4 -35.977 0-5.1376-5.4e-4 -9.8851-2.7411-12.453-7.1894-5.1022-8.8372-12.227-21.18-18.004-31.186-0.50211-0.87039-0.502-1.943 0-2.8125 0.50271-0.87073 1.4307-1.4059 2.4356-1.4062zm-37.154 12.793c-4.0923 0-7.875 2.183-9.9219 5.7266-5.7762 10.005-12.902 22.35-18.004 31.188-4.1125 7.1231-4.1125 15.896 0 23.02 5.0963 8.8286 12.215 21.157 17.988 31.158 2.0498 3.5493 5.838 5.7363 9.9375 5.7363s7.8877-2.187 9.9375-5.7363c5.7734-10.001 12.891-22.328 17.988-31.158 4.1125-7.1216 4.1125-15.896 0-23.02-5.1021-8.8372-12.228-21.182-18.006-31.188-2.0454-3.5435-5.8276-5.7266-9.9199-5.7266z" fill="currentColor"/></svg><span class="sr-only">Misskey</span></a> <a href="/feed.rss" target="_blank" rel="noopener"><i class="fa fas rss" data-fa-prefix="fas" data-fa-icon-name="rss" data-fa-option="{'classes':['fa-fw']}"></i><span>RSS</span></a> <a href="/feed.json" target="_blank" rel="noopener"><i class="fa fas rss" data-fa-prefix="fas" data-fa-icon-name="rss" data-fa-option="{'classes':['fa-fw']}"></i><span>JSON</span></a> <a href="/feed.atom" target="_blank" rel="noopener"><i class="fa fas rss" data-fa-prefix="fas" data-fa-icon-name="rss" data-fa-option="{'classes':['fa-fw']}"></i><span>Atom</span></a></div></div></div></div></div></body></html>